<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block page_title %}SonusTemper{% endblock %}</title>
  <link rel="stylesheet" href="/static/css/app.css">
  <script src="{{ static_url('vendor/htmx.min.js') }}" defer></script>
  <!-- <script src="https://unpkg.com/htmx.org@1.9.12"></script> -->
  <script defer src="/static/js/app.js"></script>
</head>
{% set current_page = current_page or '' %}
<body class="page-{{ current_page if current_page else 'start' }}">
  <div class="page">
    <div id="toast" class="toast hidden"></div>
<div class="top">
  <div>
    <h1>{% block title %}{% endblock %}</h1>
    <div class="sub">{% block subtitle %}{% endblock %}</div>
  </div>
  <div class="utilMenu">
    <button class="utilToggle" id="utilToggleGlobal" aria-haspopup="true" aria-expanded="false">â˜°</button>
    <div class="utilDropdown hidden" id="utilDropdownGlobal">
          <a href="/" class="{% if current_page=='' %}active{% endif %}">Start</a>
          <div class="divider"></div>
          <a href="/library" class="{% if current_page=='library' %}active{% endif %}">Song Library</a>
          <a href="/mastering" class="{% if current_page=='mastering' %}active{% endif %}">Mastering</a>
          <a href="/compare" class="{% if current_page=='compare' %}active{% endif %}" data-preserve-query="true">Compare</a>
          <a href="/noise_removal" class="{% if current_page=='analyze' %}active{% endif %}" data-preserve-query="true">Noise Removal</a>
          <a href="/ai" class="{% if current_page=='ai' %}active{% endif %}">AI Music Toolkit</a>
          <a href="/tagging" class="{% if current_page=='tagging' %}active{% endif %}">Tagging</a>
          <a href="/presets" class="{% if current_page=='presets' %}active{% endif %}">Preset Management</a>
          <a href="/docs" class="{% if current_page=='docs' %}active{% endif %}">Documentation</a>
    </div>
  </div>
</div>
    <div class="layout">
      <div class="sidebar-slot">
        {% block sidebar %}{% endblock %}
      </div>
      <div class="content">
        {% block content %}{% endblock %}
      </div>
    </div>
    <div class="page-footer">
      SonusTemper {{ app_version_label }} - Developed by <a href="https://www.jasondaemon.net" target="_blank" rel="noopener">jasondaemon.net</a>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      if (typeof setupUtilMenu === 'function') {
        setupUtilMenu('utilToggleGlobal','utilDropdownGlobal');
      }
      const search = window.location.search;
      if (search) {
        document.querySelectorAll('a[data-preserve-query="true"]').forEach((link) => {
          const href = link.getAttribute('href');
          if (!href) return;
          try {
            const url = new URL(href, window.location.origin);
            url.search = search;
            link.setAttribute('href', `${url.pathname}${url.search}`);
          } catch (_err) {
            return;
          }
        });
      }
    });
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>
