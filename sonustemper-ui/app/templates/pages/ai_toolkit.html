{% extends "base.html" %}
{% block page_title %}AI Music Toolkit | SonusTemper{% endblock %}
{% block title %}AI Music Toolkit{% endblock %}
{% block subtitle %}Beginner-friendly cleanup for AI-generated music.{% endblock %}

{% block sidebar %}
  <div class="card">
    <div class="card-head">
      <div>
        <div class="card-title">Status</div>
        <div class="muted">Uploads and save activity.</div>
      </div>
    </div>
    <div class="status-list" id="aiStatusList">(waiting)</div>
  </div>
  <div class="card">
    <div class="card-head">
      <div>
        <div class="card-title">Song Library</div>
        <div class="muted">Select a song or version to clean up.</div>
      </div>
    </div>
    <input type="file" id="aiLibraryUploadInput" accept=".wav,.mp3,.flac,.aiff,.aif,.m4a,.ogg,.aac" hidden>
    <div id="aiLibraryBrowser" class="library-browser-container" data-module="ai"></div>
    <div class="ai-selected-summary">
      <div class="ai-selected-label">Selected File</div>
      <div class="ai-selected-name" id="aiSelectedName">-</div>
      <div class="ai-selected-meta" id="aiSelectedMeta">No file selected.</div>
    </div>
  </div>
{% endblock %}

{% block content %}
  <div class="card ai-live-card">
    <div class="card-head">
      <div>
        <div class="card-title">Realtime Cleanup</div>
        <div class="muted">Play the track, move sliders to hear changes, then Save Cleaned Copy.</div>
      </div>
    </div>

    <div class="ai-waveform-block ai-waveform-block--overlay">
      <div class="ai-waveform-overlay" aria-hidden="true">
        <div class="ai-wave-danger ai-wave-danger--top"></div>
        <div class="ai-wave-danger ai-wave-danger--bottom"></div>
        <div class="ai-wave-line ai-wave-line--clip-top"></div>
        <div class="ai-wave-line ai-wave-line--zero"></div>
        <div class="ai-wave-line ai-wave-line--clip-bottom"></div>
        <div class="ai-wave-label ai-wave-label--clip">CLIP</div>
        <div class="ai-wave-label ai-wave-label--zero">0</div>
      </div>
      <canvas id="aiLiveScope" class="ai-live-scope" aria-hidden="true"></canvas>
      <div id="aiWaveform" class="ai-waveform"></div>
    </div>
    <div class="muted ai-wave-legend">
      <span><b>0</b> center</span> · <span><b>CLIP</b> near 0 dBFS</span> · <span>Top/Bottom tint = danger zone</span>
    </div>

    <div class="ai-transport">
      <button class="btn ghost small" type="button" id="aiPlayBtn">Play</button>
      <button class="btn ghost small" type="button" id="aiStopBtn">Stop</button>
      <span class="value-pill ai-clip-pill" id="aiClipRiskPill" hidden>CLIP RISK</span>
      <span class="ai-engine-indicator" id="aiEngineIndicator">Audio Engine: click Play</span>
      <span class="ai-engine-debug" id="aiEngineDebug"></span>
      <div class="ai-time" id="aiTimeLabel">0:00 / 0:00</div>
    </div>

    <audio id="aiAudio" preload="metadata" hidden></audio>

    <div class="ai-spectrum-block">
      <div class="ai-spectrum-title">Track spectrum + effect curve</div>
      <canvas id="aiSpectrumCanvas" class="ai-spectrum-canvas"></canvas>
    </div>

    <div class="ai-reco" id="aiRecommendations">
      <div class="ai-reco-head">
        <div class="ai-reco-title">Recommendations</div>
        <button type="button" class="btn ghost tiny" id="aiRecoApplyAll" disabled>Apply all</button>
      </div>
      <div class="ai-reco-empty muted" id="aiRecoEmpty">Load a track to see suggestions.</div>
      <div class="ai-reco-list" id="aiRecoList"></div>
    </div>

    <div class="ai-tools">
      <div class="ai-tools-hint">Play the track, move sliders to hear changes, then Save Cleaned Copy.</div>
      <div class="ai-tool-row" data-tool-id="ai_deglass">
        <div class="ai-tool-meta">
          <div class="ai-tool-title">Reduce AI Hiss / Glass</div>
          <div class="ai-tool-sub">Soften brittle top-end and reduce hiss.</div>
        </div>
        <div class="ai-tool-control">
          <label class="ai-tool-toggle">
            <input type="checkbox" data-role="enabled">
            <span>Enabled</span>
          </label>
          <input type="range" min="-6" max="3" step="0.1" value="0" data-role="value">
          <span class="value-pill" data-role="value-pill">0.0 dB</span>
        </div>
      </div>
      <div class="ai-tool-row" data-tool-id="ai_vocal_smooth">
        <div class="ai-tool-meta">
          <div class="ai-tool-title">Smooth Harsh Vocals</div>
          <div class="ai-tool-sub">Tame harsh presence and sibilant edges.</div>
        </div>
        <div class="ai-tool-control">
          <label class="ai-tool-toggle">
            <input type="checkbox" data-role="enabled">
            <span>Enabled</span>
          </label>
          <input type="range" min="-5" max="3" step="0.1" value="0" data-role="value">
          <span class="value-pill" data-role="value-pill">0.0 dB</span>
        </div>
      </div>
      <div class="ai-tool-row" data-tool-id="ai_bass_tight">
        <div class="ai-tool-meta">
          <div class="ai-tool-title">Tighten Bass / Remove Rumble</div>
          <div class="ai-tool-sub">Clean sub rumble and low-mid mud.</div>
        </div>
        <div class="ai-tool-control">
          <label class="ai-tool-toggle">
            <input type="checkbox" data-role="enabled">
            <span>Enabled</span>
          </label>
          <input type="range" min="-6" max="6" step="0.1" value="0" data-role="value">
          <span class="value-pill" data-role="value-pill">0.0 dB</span>
        </div>
      </div>
      <div class="ai-tool-row" data-tool-id="ai_transient_soften">
        <div class="ai-tool-meta">
          <div class="ai-tool-title">Reduce Pumping / Over-Transients</div>
          <div class="ai-tool-sub">Soften clicky transients and harsh bite.</div>
        </div>
        <div class="ai-tool-control">
          <label class="ai-tool-toggle">
            <input type="checkbox" data-role="enabled">
            <span>Enabled</span>
          </label>
          <input type="range" min="-6" max="4" step="0.1" value="0" data-role="value">
          <span class="value-pill" data-role="value-pill">0.0 dB</span>
        </div>
      </div>
      <div class="ai-tool-row" data-tool-id="ai_platform_safe">
        <div class="ai-tool-meta">
          <div class="ai-tool-title">Platform Ready (AI Safe Loudness)</div>
          <div class="ai-tool-sub">Safer loudness for streaming without harsh clipping.</div>
        </div>
        <div class="ai-tool-control">
          <label class="ai-tool-toggle">
            <input type="checkbox" data-role="enabled">
            <span>Enabled</span>
          </label>
          <input type="range" min="-18" max="-10" step="0.1" value="-14" data-role="value">
          <span class="value-pill" data-role="value-pill">-14.0 LUFS</span>
        </div>
      </div>
      <div class="ai-reverb-block">
        <div class="ai-reverb-head">
          <div class="ai-tool-title">Reverb Reduction (Perceptual)</div>
          <div class="ai-tool-sub">Reduces perceived room reverb using mid/side + spectral shaping.</div>
        </div>
        <div class="ai-reverb-row" data-reverb-id="side_reduction">
          <div class="ai-tool-meta">
            <div class="ai-tool-title">Side Reduction</div>
            <div class="ai-tool-sub">Reduce wide room energy.</div>
          </div>
          <div class="ai-tool-control ai-reverb-control">
            <label class="ai-tool-toggle">
              <input type="checkbox" data-role="enabled">
              <span>Enabled</span>
            </label>
            <input type="range" min="0" max="40" step="1" value="0" data-role="value">
            <span class="value-pill" data-role="value-pill">0%</span>
          </div>
        </div>
        <div class="ai-reverb-row" data-reverb-id="mid_suppress">
          <div class="ai-tool-meta">
            <div class="ai-tool-title">Mid Suppression</div>
            <div class="ai-tool-sub">Tame mid smear (~1.8 kHz).</div>
          </div>
          <div class="ai-tool-control ai-reverb-control">
            <label class="ai-tool-toggle">
              <input type="checkbox" data-role="enabled">
              <span>Enabled</span>
            </label>
            <input type="range" min="-6" max="0" step="0.1" value="0" data-role="value">
            <span class="value-pill" data-role="value-pill">0.0 dB</span>
          </div>
        </div>
        <div class="ai-reverb-row" data-reverb-id="tail_gate">
          <div class="ai-tool-meta">
            <div class="ai-tool-title">Tail Gate</div>
            <div class="ai-tool-sub">Reduce sustained tails on sparse material.</div>
          </div>
          <div class="ai-tool-control ai-reverb-control">
            <label class="ai-tool-toggle">
              <input type="checkbox" data-role="enabled">
              <span>Enabled</span>
            </label>
            <input type="range" min="-55" max="-25" step="1" value="-38" data-role="threshold">
            <span class="value-pill" data-role="threshold-pill">-38 dB</span>
            <input type="range" min="1.5" max="4" step="0.1" value="2.5" data-role="ratio">
            <span class="value-pill" data-role="ratio-pill">2.5:1</span>
          </div>
        </div>
        <div class="ai-reverb-row" data-reverb-id="low_cut">
          <div class="ai-tool-meta">
            <div class="ai-tool-title">Low Cut</div>
            <div class="ai-tool-sub">Trim low rumble in tails.</div>
          </div>
          <div class="ai-tool-control ai-reverb-control">
            <label class="ai-tool-toggle">
              <input type="checkbox" data-role="enabled">
              <span>Enabled</span>
            </label>
            <input type="range" min="60" max="220" step="5" value="120" data-role="value">
            <span class="value-pill" data-role="value-pill">120 Hz</span>
          </div>
        </div>
        <div class="ai-reverb-row" data-reverb-id="high_cut">
          <div class="ai-tool-meta">
            <div class="ai-tool-title">High Cut</div>
            <div class="ai-tool-sub">Reduce bright room tail.</div>
          </div>
          <div class="ai-tool-control ai-reverb-control">
            <label class="ai-tool-toggle">
              <input type="checkbox" data-role="enabled">
              <span>Enabled</span>
            </label>
            <input type="range" min="6000" max="14000" step="100" value="9500" data-role="value">
            <span class="value-pill" data-role="value-pill">9500 Hz</span>
          </div>
        </div>
      </div>
    </div>

    <div class="ai-save">
      <button class="btn btn-primary" type="button" id="aiSaveBtn">Save Cleaned Copy</button>
      <div class="muted" id="aiSaveStatus"></div>
      <div class="ai-save-result" id="aiSaveResult"></div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
<script src="/ui/static/vendor/wavesurfer.min.js"></script>
<script src="/static/js/library_browser.js"></script>
<script defer src="/static/js/ai_toolkit.js"></script>
{% endblock %}
