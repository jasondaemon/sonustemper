{% extends "base.html" %}
{% block page_title %}Voicing Profiles | SonusTemper{% endblock %}
{% block title %}Voicing Profiles{% endblock %}
{% block subtitle %}Create, upload, and manage voicings + delivery profiles.{% endblock %}

{% block sidebar %}
  <div class="card preset-sidebar">
    <div class="card-head">
      <div>
        <div class="card-title">Status</div>
        <div class="muted">Uploads and analysis activity.</div>
      </div>
    </div>
    <div class="status-list" id="presetStatusList">(waiting)</div>
    <div class="card-head">
      <div>
        <div class="card-title">Library</div>
        <div class="muted">User and staging voicings/profiles.</div>
      </div>
    </div>
    <div class="preset-browser">
      {% set browser_id = "presetBrowser" %}
      {% set sections = [
        {"key": "user_voicings", "title": "User Voicings", "endpoint": "/partials/library_list?view=presets_user_voicings&context=presets"},
        {"key": "user_profiles", "title": "User Profiles", "endpoint": "/partials/library_list?view=presets_user_profiles&context=presets", "autoselect": "first"},
        {"key": "generated_voicings", "title": "Generated Voicings", "endpoint": "/partials/library_list?view=presets_staging_voicings&context=presets"},
        {"key": "generated_profiles", "title": "Generated Profiles", "endpoint": "/partials/library_list?view=presets_staging_profiles&context=presets"}
      ] %}
      {% include "partials/file_browser.html" %}
    </div>
    <div class="muted" id="presetSelectedHint">Select a voicing or profile to view details.</div>
  </div>
{% endblock %}

{% block content %}
  <div id="presetPage" class="preset-grid">
    <div class="card">
      <div class="card-head">
        <div>
          <div class="card-title">Create From Reference Audio</div>
          <div class="muted">Analyze an existing song to seed a voicing and/or loudness profile.</div>
        </div>
      </div>
      <form id="presetGenerateForm" class="preset-form">
        <div class="preset-field">
          <label for="referenceFile">Audio file</label>
          <input type="file" id="referenceFile" accept=".wav,.mp3,.flac,.aiff,.aif" required>
        </div>
        <div class="preset-field">
          <label for="referenceName">Output base name (optional)</label>
          <input type="text" id="referenceName" placeholder="e.g. Airlift Stream">
        </div>
        <div class="preset-generate-row">
          <div class="preset-field preset-checkboxes">
            <label>Generate</label>
            <div class="preset-checkbox-row">
              <label class="check"><input type="checkbox" id="generateVoicing" checked> Voicing</label>
              <label class="check"><input type="checkbox" id="generateProfile" checked> Profile</label>
            </div>
          </div>
          <button class="btn btn-primary" type="button" id="referenceGenerateBtn">Analyze & Generate</button>
        </div>
      </form>
    </div>

    <div class="card">
      <div class="card-head">
        <div>
          <div class="card-title">Import JSON (Voicing or Profile)</div>
          <div class="muted">Import a JSON voicing/profile into staging before moving to your library.</div>
        </div>
      </div>
      <div class="preset-form">
        <div class="preset-field">
          <label for="presetJsonFile">JSON file</label>
          <input type="file" id="presetJsonFile" accept=".json">
        </div>
        <div class="preset-field">
          <label for="presetJsonName">Name override (optional)</label>
          <input type="text" id="presetJsonName" placeholder="e.g. Broadcast -12 LUFS">
        </div>
        <div class="preset-actions">
          <button class="btn small ghost" type="button" id="uploadPresetJsonBtn">Import to Staging</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-head">
        <div>
        <div class="card-title">Duplicate Provided Profile</div>
          <div class="muted">Create an editable user profile from a built-in loudness target.</div>
        </div>
      </div>
      <div class="preset-form">
        <div class="preset-field">
          <label for="builtinProfileSelect">Provided profile</label>
          <select id="builtinProfileSelect" class="full-width-select"></select>
        </div>
        <div class="preset-actions">
          <button class="btn small ghost" type="button" id="duplicateBuiltinProfileBtn">Duplicate to User</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-head">
        <div>
        <div class="card-title">Duplicate Provided Voicing</div>
          <div class="muted">Create an editable user voicing from a built-in tonal chain.</div>
        </div>
      </div>
      <div class="preset-form">
        <div class="preset-field">
          <label for="builtinVoicingSelect">Provided voicing</label>
          <select id="builtinVoicingSelect" class="full-width-select"></select>
        </div>
        <div class="preset-actions">
          <button class="btn small ghost" type="button" id="duplicateBuiltinVoicingBtn">Duplicate to User</button>
        </div>
      </div>
    </div>

    <div class="card preset-detail-card">
      <div class="card-head">
        <div>
          <div class="card-title">Selected Item</div>
          <div class="muted" id="presetDetailSubtitle">Choose a voicing or profile from the library.</div>
        </div>
        <div class="preset-detail-actions">
          <button class="btn small ghost" type="button" id="presetDownloadBtn" disabled>Download JSON</button>
          <button class="btn small ghost" type="button" id="presetMoveBtn" disabled>Move to User</button>
          <button class="btn small ghost" type="button" id="presetDuplicateBtn" disabled>Duplicate</button>
          <button class="btn danger small" type="button" id="presetDeleteBtn" disabled>Delete</button>
        </div>
      </div>
      <div class="preset-detail-body">
        <div class="preset-detail-title-row">
          <div class="preset-detail-title" id="presetDetailTitle">No item selected</div>
          <span class="badge" id="presetDetailKind" hidden></span>
        </div>
        <div class="preset-detail-summary" id="presetDetailSummary"></div>
        <div class="preset-detail-meta" id="presetDetailMeta">
          <div><span class="muted">Source:</span> -</div>
          <div><span class="muted">Created:</span> -</div>
          <div><span class="muted">Type:</span> -</div>
        </div>
        <div class="preset-detail-voicing" id="presetDetailVoicing" hidden>
          <div class="eq-preview preset-eq-preview">
            <svg id="presetEqPreview" width="100%" height="64" viewBox="0 0 240 64" role="img" aria-label="EQ Preview"></svg>
          </div>
          <div class="preset-detail-stats" id="presetVoicingStats"></div>
          <div class="preset-eq-table" id="presetVoicingEq"></div>
          <div class="preset-voicing-table" id="presetVoicingEditor"></div>
          <div class="preset-actions">
            <button class="btn small ghost" type="button" id="presetVoicingSaveBtn" disabled>Save Voicing</button>
          </div>
        </div>
        <div class="preset-detail-profile" id="presetDetailProfile" hidden>
          <div class="preset-detail-stats" id="presetProfileStats"></div>
          <div class="preset-profile-table" id="presetProfileEditor"></div>
          <div class="preset-actions">
            <button class="btn small ghost" type="button" id="presetProfileSaveBtn" disabled>Save Profile</button>
          </div>
        </div>
        <div class="muted" id="presetDetailHint">Select an item to view details.</div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <script defer src="/static/js/presets.js"></script>
{% endblock %}
